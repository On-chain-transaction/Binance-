<!DOCTYPE html>
<html lang="en" class="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Binance Web3 Wallet</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        // Configure Tailwind CSS to use dark mode based on class
        tailwind.config = {
            darkMode: 'class', // Enables dark mode based on the 'dark' class on the html element
            theme: {
                extend: {
                    colors: {
                        // Custom Binance-like theme colors
                        'primary-dark': '#1A1D20', // Main background for dark mode (closer to Binance)
                        'secondary-dark': '#1E2329', // Card/section background for dark mode (Binance dark gray)
                        'accent-dark': '#FCD535', // Binance yellow accent
                        'text-light': '#F0F4F8', // Light text on dark background
                        'text-muted-dark': '#A8B0BC', // Muted text on dark background
                        'dark-surface': '#2E353C', // Deeper dark for cards/elements (Binance even darker)
                        'border-dark': '#3D4955', // Dark mode border color

                        // Light mode colors (default Tailwind, but can be overridden for consistency)
                        'primary-light': '#FFFFFF',
                        'secondary-light': '#F5F5F7',
                        'accent-light': '#FCD535',
                        'text-dark': '#1A1D20',
                        'text-muted-light': '#6B7280',
                        'border-light': '#E2E8F0',
                    },
                    fontFamily: {
                        // Binance often uses a custom font, but Inter is a good, clean default
                        sans: ['Inter', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <!-- Inter Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- React and ReactDOM CDNs - MUST BE LOADED BEFORE Babel -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <!-- Babel Standalone for JSX compilation in browser -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- WalletConnect Web3-Provider & Web3.js -->
    <script src="https://unpkg.com/@walletconnect/web3-provider@1.8.0/dist/umd/index.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/web3@1.7.0/dist/web3.min.js"></script>
    <!-- Lightweight Charts for TradingView-like charts -->
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.umd.js"></script>

    <!-- PWA Manifest Link (Generated dynamically for simplicity) -->
</head>
<body class="font-sans antialiased text-text-dark bg-primary-light transition-colors duration-300">

    <div id="root"></div>

    <!-- Custom Modal for Messages (reused across pages) -->
    <div id="message-modal" class="hidden fixed inset-0 z-[1000] bg-black bg-opacity-40 flex items-center justify-center">
        <div class="bg-white dark:bg-dark-surface p-6 rounded-xl shadow-lg w-11/12 max-w-sm text-center relative">
            <span class="close-button absolute top-3 right-5 text-gray-500 hover:text-gray-800 dark:hover:text-gray-300 text-3xl cursor-pointer" id="close-modal-button">&times;</span>
            <p id="modal-message" class="text-lg text-gray-800 dark:text-text-light mt-4"></p>
        </div>
    </div>

    <!-- The application script now uses type="text/babel" -->
    <script type="text/babel">
        // Access React hooks and functions directly from the global React object
        const { useState, useEffect, useCallback, createContext, useContext, useRef } = React;

        // --- Global Message Modal Functions ---
        const messageModal = document.getElementById('message-modal');
        const modalMessage = document.getElementById('modal-message');
        const closeModalButton = document.getElementById('close-modal-button');

        const showModal = (message) => {
            modalMessage.textContent = message;
            messageModal.classList.remove('hidden');
        };

        const hideModal = () => {
            messageModal.classList.add('hidden');
        };

        if (closeModalButton) {
            closeModalButton.onclick = hideModal;
        }
        window.onclick = (event) => {
            if (event.target === messageModal) {
                hideModal();
            }
        };

        // --- PWA Manifest Generation & Simplified Setup ---
        let deferredPrompt; // To store the beforeinstallprompt event

        function setupPWA() {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                console.log('beforeinstallprompt fired, deferredPrompt stored.');
            });

            window.addEventListener('appinstalled', () => {
                console.log('PWA was installed!');
                showModal('Binance Web3 Wallet PWA installed successfully!');
            });

            window.addEventListener('load', () => {
                const manifestContent = {
                    name: 'Binance Web3 Wallet',
                    short_name: 'BinanceWallet',
                    description: 'Your secure crypto wallet powered by Binance',
                    theme_color: '#1A1D20',
                    background_color: '#1A1D20',
                    display: 'standalone',
                    scope: '/',
                    start_url: '/',
                    icons: [
                        { src: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Binance_Logo.svg', sizes: '192x192', type: 'image/svg+xml' },
                        { src: 'https://upload.wikimedia.org/wikipedia/commons/4/4c/Binance_Logo.svg', sizes: '512x512', type: 'image/svg+xml', purpose: 'maskable' }
                    ],
                    orientation: 'portrait'
                };

                const manifestBlob = new Blob([JSON.stringify(manifestContent)], { type: 'application/json' });
                const manifestUrl = URL.createObjectURL(manifestBlob);
                const link = document.createElement('link');
                link.rel = 'manifest';
                link.href = manifestUrl;
                document.head.appendChild(link);
                console.log('Manifest linked successfully.');
                console.warn("Service Worker registration from 'blob:' URLs is often restricted by browsers in single-file setups. Full PWA offline caching may not work.");
            });
        }
        setupPWA();

        // --- User Context for Persistent Login ---
        const UserContext = createContext(null);

        // --- Shared Components ---
        const DarkModeToggle = ({ isDarkMode, toggleDarkMode }) => (
            <button
                onClick={toggleDarkMode}
                className="p-2 rounded-full bg-secondary-light dark:bg-secondary-dark text-text-dark dark:text-text-light hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-accent-dark"
                aria-label="Toggle dark mode"
            >
                {isDarkMode ? (
                    <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 00-.707-.293h-1.414a1 1 0 100 2h1.414a1 1 0 00.707-.293zm-9.192 9.192a1 1 0 00-.707.293l-.707.707a1 1 0 001.414 1.414l.707-.707a1 1 0 00-.293-1.414zM4 10a1 1 0 01-1-1V8a1 1 0 112 0v1a1 1 0 01-1 1zm-4.95-3.536a1 1 0 00.293.707L1.464 8.536a1 1 0 101.414-1.414L2.05 6.464a1 1 0 00-.707-.293zM16 10a1 1 0 01-1-1V8a1 1 0 112 0v1a1 1 0 01-1 1zm4.95-3.536a1 1 0 00-.293.707l-.707.707a1 1 0 00-1.414-1.414l.707-.707a1 1 0 00.707-.293z"></path></svg>
                ) : (
                    <svg className="w-6 h-6" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path d="M17.293 13.04a.75.75 0 010 1.06l-.707.707a.75.75 0 01-1.06 0L14 13.04a6 6 0 11-8.485-8.485.75.75 0 011.06 1.06A4.5 4.5 0 1015.939 12a.75.75 0 011.354.54z"></path></svg>
                )}
            </button>
        );

        const Header = ({ toggleDarkMode, isDarkMode, navigate, goBack, showBackButton }) => {
            const { userStatus, setUserStatus } = useContext(UserContext);

            const handleDisconnectWallet = () => {
                showModal('Disconnecting wallet...');
                setTimeout(() => {
                    setUserStatus({ isLoggedIn: userStatus.isLoggedIn, connectedWalletInfo: null }); // Keep login status, but clear wallet
                    showModal('Wallet disconnected!');
                    hideModal();
                }, 1500);
            };

            return (
                <header className="bg-white dark:bg-secondary-dark shadow-sm dark:shadow-md fixed top-0 left-0 right-0 z-50 transition-colors duration-300">
                    <nav className="container mx-auto px-4 py-3 flex justify-between items-center">
                        {/* Back Button */}
                        {showBackButton && (
                            <button
                                onClick={goBack}
                                className="mr-3 p-2 rounded-full bg-gray-100 dark:bg-dark-surface text-text-dark dark:text-text-light hover:bg-gray-200 dark:hover:bg-gray-700 transition-colors duration-300 focus:outline-none focus:ring-2 focus:ring-accent-dark"
                                aria-label="Go back"
                            >
                                <svg className="w-5 h-5 rtl:rotate-180" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">
                                    <path stroke="currentColor" strokeLinecap="round" strokeLinejoin="round" strokeWidth="2" d="M13 5H1m0 0 4 4m-4-4 4-4"/>
                                </svg>
                            </button>
                        )}

                        {/* Logo */}
                        <div className="flex items-center space-x-2 cursor-pointer" onClick={() => navigate('landingPage')}>
                            {/* Real Binance Logo */}
                            <img src="https://upload.wikimedia.org/wikipedia/commons/4/4c/Binance_Logo.svg" alt="Binance Logo" className="w-10 h-10" />
                            <span className="text-xl font-bold text-text-dark dark:text-text-light">Binance Web3 Wallet</span>
                        </div>

                        {/* Navigation Links - Hidden on small screens, shown on medium and up */}
                        <div className="hidden md:flex items-center space-x-6">
                            <a href="#" onClick={() => navigate('homePage')} className="text-text-dark dark:text-text-light hover:text-accent-dark dark:hover:text-accent-dark font-medium transition-colors duration-200">Home</a>
                            {userStatus.isLoggedIn && (
                                <a href="#" onClick={() => navigate('walletDashboard')} className="text-text-dark dark:text-text-light hover:text-accent-dark dark:hover:text-accent-dark font-medium transition-colors duration-200">Wallet</a>
                            )}
                            <a href="#" onClick={() => navigate('getStartedPage')} className="text-text-dark dark:text-text-light hover:text-accent-dark dark:hover:text-accent-dark font-medium transition-colors duration-200">Get Started</a>
                        </div>

                        {/* Action Buttons & Dark Mode Toggle - Always visible, layout changes */}
                        <div className="flex items-center space-x-3 sm:space-x-4">
                            {!userStatus.isLoggedIn && (
                                <button
                                    onClick={() => navigate('loginPage')}
                                    className="hidden sm:inline-block px-4 py-2 text-sm font-semibold text-text-dark dark:text-text-light rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-accent-dark"
                                >
                                    Log In
                                </button>
                            )}

                            {userStatus.connectedWalletInfo ? (
                                <div className="relative group">
                                    <button
                                        onClick={() => navigate('walletConnectPage')}
                                        className="px-4 py-2 text-sm font-semibold bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-green-500"
                                    >
                                        Wallet Connected
                                    </button>
                                    <div className="absolute right-0 mt-2 w-48 bg-white dark:bg-secondary-dark rounded-lg shadow-xl py-1 hidden group-hover:block transition-all duration-300 origin-top-right">
                                        <div className="px-4 py-2 text-sm text-gray-700 dark:text-text-muted-dark break-all">
                                            {userStatus.connectedWalletInfo.address ?
                                                `${userStatus.connectedWalletInfo.address.substring(0, 6)}...${userStatus.connectedWalletInfo.address.substring(userStatus.connectedWalletInfo.address.length - 4)}`
                                                : userStatus.connectedWalletInfo.username}
                                        </div>
                                        <button
                                            onClick={handleDisconnectWallet}
                                            className="block w-full text-left px-4 py-2 text-sm text-red-500 hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200"
                                        >
                                            Disconnect
                                        </button>
                                    </div>
                                </div>
                            ) : (
                                <button
                                    onClick={() => navigate('walletConnectPage')}
                                    className="px-4 py-2 text-sm font-semibold bg-accent-dark text-primary-dark rounded-lg hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-accent-dark"
                                >
                                    Connect Wallet
                                </button>
                            )}

                            {userStatus.isLoggedIn && (
                                <button
                                    onClick={() => navigate('settingsPage')}
                                    className="px-4 py-2 text-sm font-semibold text-text-dark dark:text-text-light rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-accent-dark"
                                >
                                    Settings
                                </button>
                            )}
                            <DarkModeToggle isDarkMode={isDarkMode} toggleDarkMode={toggleDarkMode} />
                        </div>
                    </nav>
                </header>
            );
        };

        const Footer = () => (
            <footer className="bg-white dark:bg-secondary-dark py-10 text-text-muted-light dark:text-text-muted-dark transition-colors duration-300">
                <div className="container mx-auto px-4 grid grid-cols-1 md:grid-cols-4 gap-8">
                    {/* Column 1: Logo and social */}
                    <div className="space-y-4">
                        <div className="flex items-center space-x-2">
                            <img src="https://upload.wikimedia.org/wikipedia/commons/4/4c/Binance_Logo.svg" alt="Binance Logo" className="w-8 h-8" />
                            <span className="text-lg font-bold text-text-dark dark:text-text-light">Binance Web3 Wallet</span>
                        </div>
                        <p>Your secure gateway to the decentralized world.</p>
                        <div className="flex space-x-4">
                            <a href="#" className="hover:text-accent-dark transition-colors duration-200">üê¶</a>
                            <a href="#" className="hover:text-accent-dark transition-colors duration-200">üîó</a>
                            <a href="#" className="hover:text-accent-dark transition-colors duration-200">üí¨</a>
                        </div>
                    </div>

                    {/* Column 2: Products */}
                    <div>
                        <h4 className="font-semibold text-text-dark dark:text-text-light mb-4">Products</h4>
                        <ul className="space-y-2">
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to Wallet App details...'); }}>Wallet App</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to Exchange...'); }}>Exchange</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to NFT Marketplace...'); }}>NFT Marketplace</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to Staking...'); }}>Staking</a></li>
                        </ul>
                    </div>

                    {/* Column 3: Company */}
                    <div>
                        <h4 className="font-semibold text-text-dark dark:text-text-light mb-4">Company</h4>
                        <ul className="space-y-2">
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to About Us...'); }}>About Us</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to Careers...'); }}>Careers</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to Blog...'); }}>Blog</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to Partnerships...'); }}>Partnerships</a></li>
                        </ul>
                    </div>

                    {/* Column 4: Support */}
                    <div>
                        <h4 className="font-semibold text-text-dark dark:text-text-light mb-4">Support</h4>
                        <ul className="space-y-2">
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to Help Center...'); }}>Help Center</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to Contact Us...'); }}>Contact Us</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to Community...'); }}>Community</a></li>
                            <li><a href="#" onClick={(e) => { e.preventDefault(); showModal('Navigating to Legal...'); }}>Legal</a></li>
                        </ul>
                    </div>
                </div>
                <div className="border-t border-gray-200 dark:border-gray-700 mt-8 pt-6 text-center text-sm">
                    &copy; 2025 CryptoWallet. All rights reserved.
                </div>
            </footer>
        );

        // --- Page Components ---

        const LandingPage = ({ navigate }) => {
            const FeatureCard = ({ title, description }) => ( // Removed icon prop
                <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg hover:shadow-xl transition-shadow duration-300 flex flex-col items-center text-center">
                    <h3 className="text-xl font-semibold mb-2 text-text-dark dark:text-text-light">{title}</h3>
                    <p className="text-text-muted-light dark:text-text-muted-dark">{description}</p>
                </div>
            );

            const handleGetAppClick = () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    deferredPrompt.userChoice.then((choiceResult) => {
                        if (choiceResult.outcome === 'accepted') {
                            showModal('Binance Web3 Wallet PWA installation accepted!');
                        } else {
                            showModal('Binance Web3 Wallet PWA installation dismissed.');
                        }
                        deferredPrompt = null;
                    });
                } else {
                    showModal('PWA installation prompt not available. You might need to add to home screen manually.');
                    console.log('No deferredPrompt available.');
                }
            };

            return (
                <div className="min-h-screen pt-16">
                    <section className="relative bg-primary-light dark:bg-primary-dark pt-8 pb-16 md:pt-16 md:pb-24 lg:pt-20 lg:pb-32 text-center overflow-hidden transition-colors duration-300">
                        <div className="container mx-auto px-4 relative z-10">
                            <h1 className="text-4xl sm:text-5xl lg:text-6xl font-extrabold leading-tight mb-4 text-text-dark dark:text-text-light">
                                Your Gateway to <br className="hidden md:inline"/> Decentralized Finance
                            </h1>
                            <p className="text-lg sm:text-xl text-text-muted-light dark:text-text-muted-dark mb-8 max-w-2xl mx-auto">
                                Securely manage your crypto assets, explore Web3, and connect to DApps with ease.
                            </p>
                            <div className="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                                <button
                                    onClick={() => navigate('getStartedPage')}
                                    className="px-6 py-3 bg-accent-dark text-primary-dark font-semibold rounded-lg shadow-lg hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-accent-dark focus:ring-offset-2 dark:focus:ring-offset-primary-dark"
                                >
                                    Get Started
                                </button>
                                <button
                                    onClick={() => navigate('walletConnectPage')}
                                    className="px-6 py-3 border border-text-muted-light dark:border-text-muted-dark text-text-dark dark:text-text-light font-semibold rounded-lg shadow-lg hover:bg-gray-100 dark:hover:bg-secondary-dark transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-accent-dark focus:ring-offset-2 dark:focus:ring-offset-primary-dark"
                                >
                                    Connect Wallet
                                </button>
                            </div>
                        </div>
                        {/* Background gradient/shapes for visual appeal */}
                        <div className="absolute inset-0 bg-gradient-to-br from-blue-100/30 via-purple-100/30 to-pink-100/30 dark:from-purple-900/10 dark:via-blue-900/10 dark:to-teal-900/10 opacity-50 blur-3xl"></div>
                    </section>

                    <section id="features" className="bg-secondary-light dark:bg-primary-dark py-16 md:py-24 transition-colors duration-300">
                        <div className="container mx-auto px-4">
                            <h2 className="text-3xl sm:text-4xl font-bold text-center mb-12 text-text-dark dark:text-text-light">
                                Why Choose Our Wallet?
                            </h2>
                            <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-8">
                                <FeatureCard title="Unrivaled Security" description={"Your assets are protected with industry-leading encryption and multi-factor authentication."}/>
                                <FeatureCard title="Blazing Fast Transactions" description={"Experience lightning-quick transfers and confirmations across multiple blockchains."}/>
                                <FeatureCard title="Seamless Asset Management" description={"Easily send, receive, and swap a wide range of cryptocurrencies and NFTs."}/>
                                <FeatureCard title="Integrated DApp Browser" description={"Connect securely to your favorite decentralized applications directly from your wallet."}/>
                                <FeatureCard title="Real-time Portfolio Tracking" description={"Monitor your investments with live price updates and comprehensive analytics."}/>
                                <FeatureCard title="User-Friendly Interface" description={"Designed for both beginners and seasoned crypto enthusiasts, simple yet powerful."}/>
                            </div>
                        </div>
                    </section>

                    <section className="bg-primary-dark dark:bg-secondary-dark py-16 md:py-24 text-center text-text-light dark:text-text-light transition-colors duration-300">
                        <div className="container mx-auto px-4">
                            <h2 className="text-3xl sm:text-4xl font-bold mb-6">
                                Ready to Take Control of Your Crypto?
                            </h2>
                            <p className="text-lg mb-8 max-w-3xl mx-auto text-text-muted-dark">
                                Join millions of users worldwide who trust our platform for their digital assets. Get started today and unlock the full potential of Web3.
                            </p>
                            <div className="flex flex-col sm:flex-row justify-center space-y-4 sm:space-y-0 sm:space-x-4">
                                <button
                                    onClick={handleGetAppClick}
                                    className="px-6 py-3 bg-accent-dark text-primary-dark font-semibold rounded-lg shadow-lg hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-accent-dark focus:ring-offset-2 dark:focus:ring-offset-secondary-dark"
                                >
                                    Get App
                                </button>
                                <button
                                    onClick={() => navigate('getStartedPage')}
                                    className="px-6 py-3 border border-text-muted-dark text-text-light font-semibold rounded-lg shadow-lg hover:bg-gray-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-accent-dark focus:ring-offset-2 dark:focus:ring-offset-secondary-dark"
                                >
                                    Explore Products
                                </button>
                            </div>
                        </div>
                    </section>
                </div>
            );
        };

        const GetStartedPage = ({ navigate }) => (
            <div className="min-h-screen flex flex-col items-center justify-center bg-primary-light dark:bg-primary-dark pt-16 transition-colors duration-300 p-4">
                <div className="bg-white dark:bg-secondary-dark p-8 rounded-xl shadow-lg w-11/12 max-w-md text-center border border-gray-200 dark:border-gray-700">
                    <h2 className="text-3xl font-bold text-text-dark dark:text-text-light mb-8">Get Started</h2>
                    <div className="flex flex-col space-y-4">
                        <button
                            onClick={() => navigate('loginPage')}
                            className="w-full px-6 py-3 bg-accent-dark text-primary-dark font-semibold rounded-lg shadow-md hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-accent-dark"
                        >
                            Log In
                        </button>
                        <button
                            onClick={() => navigate('walletConnectPage')}
                            className="w-full px-6 py-3 border border-text-muted-light dark:border-text-muted-dark text-text-dark dark:text-text-light font-semibold rounded-lg shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-accent-dark"
                        >
                            Connect Wallet
                        </button>
                    </div>
                </div>
            </div>
        );

        const LoginPage = ({ navigate, setUserStatus }) => {
            const [email, setEmail] = useState('');
            const [password, setPassword] = useState('');
            const [isLoading, setIsLoading] = useState(false);

            const handleLogin = (e) => {
                e.preventDefault();
                setIsLoading(true);
                showModal('Logging in...');

                setTimeout(() => {
                    setIsLoading(false);
                    hideModal();
                    // Simulate successful login
                    setUserStatus({ isLoggedIn: true, connectedWalletInfo: null }); // Keep wallet disconnected on login
                    navigate('homePage');
                }, 3000);
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-primary-light dark:bg-primary-dark pt-16 transition-colors duration-300 p-4">
                    <div className="bg-white dark:bg-secondary-dark p-8 rounded-xl shadow-lg w-11/12 max-w-md border border-gray-200 dark:border-gray-700">
                        <h2 className="text-3xl font-bold text-text-dark dark:text-text-light mb-6 text-center">Log In</h2>
                        <form onSubmit={handleLogin}>
                            <div className="mb-4">
                                <label htmlFor="email" className="block text-text-dark dark:text-text-light text-sm font-medium mb-2">Email / Mobile</label>
                                <input
                                    type="text"
                                    id="email"
                                    className="w-full px-4 py-3 rounded-lg bg-gray-100 dark:bg-dark-surface text-text-dark dark:text-text-light border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-accent-dark"
                                    placeholder="Enter email or mobile"
                                    value={email}
                                    onChange={(e) => setEmail(e.target.value)}
                                    required
                                />
                            </div>
                            <div className="mb-6">
                                <label htmlFor="password" className="block text-text-dark dark:text-text-light text-sm font-medium mb-2">Password</label>
                                <input
                                    type="password"
                                    id="password"
                                    className="w-full px-4 py-3 rounded-lg bg-gray-100 dark:bg-dark-surface text-text-dark dark:text-text-light border border-gray-300 dark:border-gray-700 focus:outline-none focus:ring-2 focus:ring-accent-dark"
                                    placeholder="Enter password"
                                    value={password}
                                    onChange={(e) => setPassword(e.target.value)}
                                    required
                                />
                            </div>
                            <button
                                type="submit"
                                className="w-full px-6 py-3 bg-accent-dark text-primary-dark font-semibold rounded-lg shadow-md hover:opacity-90 transition-opacity duration-200 focus:outline-none focus:ring-2 focus:ring-accent-dark"
                                disabled={isLoading}
                            >
                                {isLoading ? (
                                    <span className="flex items-center justify-center">
                                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-primary-dark mr-3"></div>
                                        Logging In...
                                    </span>
                                ) : 'Log In'}
                            </button>
                            <p className="text-center text-sm text-text-muted-light dark:text-text-muted-dark mt-4">
                                Don't have an account? <a href="#" onClick={(e) => { e.preventDefault(); showModal('For a full app, you would navigate to a sign-up page here.'); }} className="text-accent-dark hover:underline">Register Now</a>
                            </p>
                        </form>
                    </div>
                </div>
            );
        };

        const WalletConnectPage = ({ navigate, setUserStatus }) => {
            const { userStatus } = useContext(UserContext);
            const [activeSection, setActiveSection] = useState('walletconnect'); // 'walletconnect' or 'manual'
            const [walletConnectStatus, setWalletConnectStatus] = useState("Connect your Ethereum wallet via WalletConnect.");
            const [connectedAddress, setConnectedAddress] = useState(userStatus.connectedWalletInfo?.address || '');
            const [isWalletConnectLoading, setIsWalletConnectLoading] = useState(false);
            const [isManualLoading, setIsManualLoading] = useState(false);

            // Manual Connect States
            const [selectedNetworkId, setSelectedNetworkId] = useState('');
            const [manualAddressInput, setManualAddressInput] = useState('');
            const [manualNetworkDisplay, setManualNetworkDisplay] = useState(userStatus.connectedWalletInfo?.network || '');
            const [manualAddressDisplay, setManualAddressDisplay] = useState(userStatus.connectedWalletInfo?.address || '');
            const [manualBalanceDisplay, setManualBalanceDisplay] = useState(userStatus.connectedWalletInfo?.balance || '');
            const [showManualConnectInfo, setShowManualConnectInfo] = useState(!!userStatus.connectedWalletInfo);

            useEffect(() => {
                // Update local state if userStatus changes externally (e.g., disconnect from header)
                if (!userStatus.connectedWalletInfo) {
                    setConnectedAddress('');
                    setWalletConnectStatus("Connect your Ethereum wallet via WalletConnect.");
                    setManualNetworkDisplay('');
                    setManualAddressDisplay('');
                    setManualBalanceDisplay('');
                    setShowManualConnectInfo(false);
                } else {
                    setConnectedAddress(userStatus.connectedWalletInfo.address || '');
                    setManualNetworkDisplay(userStatus.connectedWalletInfo.network || '');
                    setManualAddressDisplay(userStatus.connectedWalletInfo.address || '');
                    setManualBalanceDisplay(userStatus.connectedWalletInfo.balance || '');
                    setShowManualConnectInfo(true);
                    if (userStatus.connectedWalletInfo.type === 'manual') {
                        setActiveSection('manual');
                    } else {
                        setActiveSection('walletconnect');
                    }
                }
            }, [userStatus.connectedWalletInfo]);


            const networks = [
                { id: 'btc', name: 'Bitcoin (BTC)', type: 'non-evm', symbol: 'BTC', api: 'https://api.blockcypher.com/v1/btc/main/addrs/' },
                { id: 'eth-erc20', name: 'Ethereum (ETH ERC20)', type: 'evm', symbol: 'ETH', rpc: 'https://mainnet.infura.io/v3/YOUR_INFURA_PROJECT_ID' }, // Replace with your Infura ID
                { id: 'bnb-bep20', name: 'BNB Smart Chain (BSC BEP20)', type: 'evm', symbol: 'BNB', rpc: 'https://bsc-dataseed.binance.org/' },
                { id: 'tron-trc20', name: 'TRON (TRX TRC20)', type: 'non-evm', symbol: 'TRX', api: 'https://api.trongrid.io/wallet/getaccount' },
                { id: 'sol', name: 'Solana (SOL)', type: 'non-evm', symbol: 'SOL', rpc: 'https://api.mainnet-beta.solana.com' },
                { id: 'polygon', name: 'Polygon (MATIC)', type: 'evm', symbol: 'MATIC', rpc: 'https://polygon-rpc.com/' },
                { id: 'avalanche', name: 'Avalanche C-Chain (AVAX)', type: 'evm', symbol: 'AVAX', rpc: 'https://api.avax.network/ext/bc/C/rpc' },
                { id: 'arbitrum', name: 'Arbitrum One (ARB)', type: 'evm', symbol: 'ETH', rpc: 'https://arb1.arbitrum.io/rpc' },
                { id: 'optimism', name: 'Optimism (OP)', type: 'evm', symbol: 'ETH', rpc: 'https://mainnet.optimism.io' },
                { id: 'fantom', name: 'Fantom (FTM)', type: 'evm', symbol: 'FTM', rpc: 'https://rpc.ftm.tools/' },
                { id: 'polkadot', name: 'Polkadot (DOT)', type: 'non-evm', symbol: 'DOT', api: 'N/A' },
                { id: 'cosmos', name: 'Cosmos (ATOM)', type: 'non-evm', symbol: 'ATOM', api: 'N/A' },
                { id: 'cardano', name: 'Cardano (ADA)', type: 'non-evm', symbol: 'ADA', api: 'N/A' },
                { id: 'xrp', name: 'XRP Ledger (XRP)', type: 'non-evm', symbol: 'XRP', api: 'N/A' },
                { id: 'near', name: 'Near Protocol (NEAR)', type: 'non-evm', symbol: 'NEAR', api: 'N/A' }
            ];

            // --- WalletConnect Logic ---
            const handleConnectWallet = async () => {
                setIsWalletConnectLoading(true);
                setWalletConnectStatus('Connecting...');
                showModal('Opening WalletConnect modal...');

                try {
                    const provider = new WalletConnectProvider.default({
                        projectId: "0e0d74e5227e248cffdc16006c9e7e2f", // YOUR WALLETCONNECT PROJECT ID
                        chains: [1],
                        infuraId: "YOUR_INFURA_PROJECT_ID", // YOUR INFURA PROJECT ID
                        showQrModal: true
                    });

                    await provider.enable();
                    const web3 = new Web3(provider);
                    const accounts = await web3.eth.getAccounts();

                    if (accounts.length > 0) {
                        const account = accounts[0];
                        setConnectedAddress(account);
                        setWalletConnectStatus('You\'re connected!');
                        showModal(`Successfully connected wallet: ${account}`);
                        // Simulate balance fetch
                        const simulatedBalance = '0.12345 ETH';
                        setUserStatus({ isLoggedIn: userStatus.isLoggedIn, connectedWalletInfo: { address: account, balance: simulatedBalance, network: 'Ethereum', type: 'walletconnect' } });
                    } else {
                        showModal("No accounts found. Please try connecting again.");
                        setWalletConnectStatus("Failed to connect wallet.");
                    }
                } catch (error) {
                    console.error("Wallet connection failed:", error);
                    let errorMessage = "An unknown error occurred.";
                    if (error.message && error.message.includes("User closed modal")) {
                        errorMessage = "WalletConnect modal was closed. Please try again to connect.";
                    } else if (error.message) {
                        errorMessage = error.message;
                    } else if (error.code) {
                        errorMessage = `Error Code: ${error.code}`;
                    }
                    showModal(`Connection Error: ${errorMessage}. Please try again.`);
                    setWalletConnectStatus("Failed to connect wallet.");
                } finally {
                    setIsWalletConnectLoading(false);
                    hideModal();
                }
            };

            const handleDisconnectWallet = () => {
                showModal('Disconnecting wallet...');
                setTimeout(() => {
                    setUserStatus({ isLoggedIn: userStatus.isLoggedIn, connectedWalletInfo: null });
                    showModal('Wallet disconnected!');
                    hideModal();
                }, 1500);
            };

            // --- Manual Connect Logic ---
            const handleFetchBalance = async () => {
                const address = manualAddressInput.trim();
                if (!selectedNetworkId) {
                    showModal('Please select a network.');
                    return;
                }
                if (!address) {
                    showModal('Please enter a wallet address.');
                    return;
                }

                setIsManualLoading(true);
                setShowManualConnectInfo(false);
                showModal('Fetching balance, please wait...');

                const network = networks.find(n => n.id === selectedNetworkId);
                let balance = 'N/A';
                try {
                    // Simulating API call delays
                    await new Promise(resolve => setTimeout(resolve, 2000));

                    if (network.type === 'evm') {
                        if (!network.rpc || network.rpc.includes('YOUR_INFURA_PROJECT_ID')) {
                            showModal(`Please replace 'YOUR_INFURA_PROJECT_ID' with a valid Infura ID for EVM network RPC access.`);
                            balance = 'RPC Not Configured (Simulated)';
                        } else {
                            // This would be a real web3 call if Infura ID was provided
                            // const web3 = new Web3(new Web3.providers.HttpProvider(network.rpc));
                            // const weiBalance = await web3.eth.getBalance(address);
                            // balance = web3.utils.fromWei(weiBalance, 'ether') + ` ${network.symbol}`;
                            balance = `${(Math.random() * 5).toFixed(4)} ${network.symbol} (Simulated)`;
                        }
                    } else { // Non-EVM chains - Simplified fetch for this demo
                        balance = `${(Math.random() * 1000).toFixed(2)} ${network.symbol} (Simulated)`;
                    }
                } catch (error) {
                    console.error(`Error fetching balance for ${network.name}:`, error);
                    balance = 'Error (Simulated)';
                    showModal(`Error fetching balance for ${network.name}: ${error.message || error}.`);
                } finally {
                    setManualNetworkDisplay(network.name);
                    setManualAddressDisplay(address);
                    setManualBalanceDisplay(balance);
                    setShowManualConnectInfo(true);
                    setIsManualLoading(false);
                    hideModal(); // Hide fetching modal

                    setUserStatus({ isLoggedIn: userStatus.isLoggedIn, connectedWalletInfo: { address: address, balance: balance, network: network.name, type: 'manual' } });
                }
            };


            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-primary-light dark:bg-primary-dark pt-16 p-4 transition-colors duration-300">
                    <div className="bg-white dark:bg-secondary-dark p-8 rounded-2xl shadow-xl max-w-md w-full text-center border border-gray-200 dark:border-gray-700">
                        <h1 className="text-3xl font-extrabold text-gray-800 dark:text-text-light mb-6">Wallet Connection Options</h1>

                        {/* Toggle Buttons */}
                        <div className="flex justify-center gap-4 mb-6">
                            <button
                                onClick={() => setActiveSection('walletconnect')}
                                className={`px-6 py-3 rounded-xl font-semibold shadow-md transition duration-300 ${activeSection === 'walletconnect' ? 'bg-accent-dark text-primary-dark' : 'bg-gray-200 text-gray-800 dark:bg-dark-surface dark:text-text-light hover:bg-gray-300 dark:hover:bg-gray-600'}`}
                            >
                                WalletConnect
                            </button>
                            <button
                                onClick={() => setActiveSection('manual')}
                                className={`px-6 py-3 rounded-xl font-semibold shadow-md transition duration-300 ${activeSection === 'manual' ? 'bg-accent-dark text-primary-dark' : 'bg-gray-200 text-gray-800 dark:bg-dark-surface dark:text-text-light hover:bg-gray-300 dark:hover:bg-gray-600'}`}
                            >
                                Manual Connect
                            </button>
                        </div>

                        <hr className="my-6 border-gray-200 dark:border-gray-700" />

                        {activeSection === 'walletconnect' && (
                            <div className="flex flex-col items-center">
                                <div id="status-message" className="mb-6 text-lg text-gray-600 dark:text-text-muted-dark">
                                    {walletConnectStatus}
                                </div>
                                {!userStatus.connectedWalletInfo || userStatus.connectedWalletInfo.type !== 'walletconnect' ? (
                                    <button
                                        onClick={handleConnectWallet}
                                        className="bg-accent-dark hover:opacity-90 text-primary-dark font-bold py-3 px-6 rounded-xl shadow-lg
                                                   transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-accent-dark
                                                   w-full flex items-center justify-center gap-2"
                                        disabled={isWalletConnectLoading}
                                    >
                                        {isWalletConnectLoading ? (
                                            <span className="flex items-center justify-center">
                                                <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-primary-dark mr-3"></div>
                                                Connecting...
                                            </span>
                                        ) : (
                                            <>
                                                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                    <path fillRule="evenodd" d="M3 8a2 2 0 012-2h10a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5-3a1 1 0 00-1 1v2a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd"></path>
                                                </svg>
                                                Connect Wallet
                                            </>
                                        )}
                                    </button>
                                ) : (
                                    <div className="mt-8 p-4 bg-gray-50 dark:bg-dark-surface border border-gray-200 dark:border-gray-700 rounded-xl w-full">
                                        <h2 className="text-xl font-semibold text-gray-700 dark:text-text-light mb-2">Wallet Connected!</h2>
                                        <p className="text-gray-600 dark:text-text-muted-dark break-all">
                                            <span className="font-medium">Address:</span> <span className="text-accent-dark font-mono">{connectedAddress}</span>
                                        </p>
                                        <p className="text-gray-600 dark:text-text-muted-dark break-all mt-1">
                                            <span className="font-medium">Balance:</span> <span className="text-accent-dark font-mono">{userStatus.connectedWalletInfo.balance}</span>
                                        </p>
                                        <button
                                            onClick={handleDisconnectWallet}
                                            className="mt-4 w-full px-4 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-colors duration-200"
                                        >
                                            Disconnect Wallet
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}

                        {activeSection === 'manual' && (
                            <div className="flex flex-col items-center mt-8">
                                <h2 className="text-2xl font-bold text-gray-800 dark:text-text-light mb-4">Manual Wallet Connection</h2>
                                <p className="text-sm text-red-600 mb-4 text-center p-2 bg-red-50 dark:bg-red-900/20 rounded-lg border border-red-200 dark:border-red-700">
                                    Note: Manual connection is primarily for **viewing balances** and does not enable transactions or signing messages.
                                    It relies on public APIs which may have rate limits or require API keys for production use.
                                </p>

                                {!userStatus.connectedWalletInfo || userStatus.connectedWalletInfo.type !== 'manual' ? (
                                    <>
                                        <div className="w-full max-w-sm mb-4">
                                            <label htmlFor="network-select" className="block text-left text-gray-700 dark:text-text-muted-dark text-sm font-bold mb-2">Select Network:</label>
                                            <select
                                                id="network-select"
                                                className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 dark:text-text-light leading-tight
                                                           focus:outline-none focus:shadow-outline focus:ring-2 focus:ring-accent-dark bg-white dark:bg-dark-surface dark:border-gray-700"
                                                value={selectedNetworkId}
                                                onChange={(e) => {
                                                    setSelectedNetworkId(e.target.value);
                                                    setShowManualConnectInfo(false); // Hide info when network changes
                                                    setManualAddressInput(''); // Clear address input
                                                }}
                                            >
                                                <option value="">Select a Network</option>
                                                {networks.map(network => (
                                                    <option key={network.id} value={network.id}>{network.name}</option>
                                                ))}
                                            </select>
                                        </div>

                                        {selectedNetworkId && (
                                            <div className="w-full max-w-sm mb-4">
                                                <label htmlFor="wallet-address-input" className="block text-left text-gray-700 dark:text-text-muted-dark text-sm font-bold mb-2">Enter Address:</label>
                                                <input
                                                    type="text"
                                                    id="wallet-address-input"
                                                    placeholder="e.g., 0x..."
                                                    className="shadow appearance-none border rounded-lg w-full py-3 px-4 text-gray-700 dark:text-text-light leading-tight
                                                               focus:outline-none focus:shadow-outline focus:ring-2 focus:ring-accent-dark bg-gray-100 dark:bg-dark-surface dark:border-gray-700"
                                                    value={manualAddressInput}
                                                    onChange={(e) => setManualAddressInput(e.target.value)}
                                                />
                                            </div>
                                        )}

                                        {selectedNetworkId && (
                                            <button
                                                onClick={handleFetchBalance}
                                                className="bg-accent-dark hover:opacity-90 text-primary-dark font-bold py-3 px-6 rounded-xl shadow-lg
                                                           transition duration-300 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-4 focus:ring-accent-dark
                                                           w-full max-w-sm flex items-center justify-center gap-2"
                                                disabled={isManualLoading}
                                            >
                                                {isManualLoading ? (
                                                    <span className="flex items-center justify-center">
                                                        <div className="animate-spin rounded-full h-5 w-5 border-b-2 border-primary-dark mr-3"></div>
                                                        Connect
                                                    </span>
                                                ) : (
                                                    <>
                                                        <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                                                            <path fillRule="evenodd" d="M3 8a2 2 0 012-2h10a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2V8zm5-3a1 1 0 00-1 1v2a1 1 0 102 0V6a1 1 0 00-1-1z" clipRule="evenodd"></path>
                                                        </svg>
                                                        Connect
                                                    </>
                                                )}
                                            </button>
                                        )}
                                    </>
                                ) : (
                                    <div className="mt-8 p-4 bg-gray-50 dark:bg-dark-surface border border-gray-200 dark:border-gray-700 rounded-xl w-full max-w-sm text-left">
                                        <h2 className="text-xl font-semibold text-gray-700 dark:text-text-light mb-2">Manual Connection Details:</h2>
                                        <p className="text-gray-600 dark:text-text-muted-dark break-all mb-2">
                                            <span className="font-medium">Network:</span> <span className="text-accent-dark">{manualNetworkDisplay}</span>
                                        </p>
                                        <p className="text-gray-600 dark:text-text-muted-dark break-all mb-2">
                                            <span className="font-medium">Address:</span> <span className="text-accent-dark font-mono">{manualAddressDisplay}</span>
                                        </p>
                                        <p className="text-gray-600 dark:text-text-muted-dark break-all">
                                            <span className="font-medium">Balance:</span> <span className="text-accent-dark font-mono">{manualBalanceDisplay}</span>
                                        </p>
                                        <button
                                            onClick={handleDisconnectWallet}
                                            className="mt-4 w-full px-4 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-colors duration-200"
                                        >
                                            Disconnect Wallet
                                        </button>
                                    </div>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        // Component for rendering a Lightweight Chart
        const TradingViewChart = ({ data, coinSymbol }) => {
            const chartContainerRef = useRef();
            const chartRef = useRef(null);
            const seriesRef = useRef(null);

            useEffect(() => {
                // Ensure the chart container is available and LightweightCharts is loaded
                if (!chartContainerRef.current || !window.LightweightCharts) {
                    console.warn("Chart container not ready or LightweightCharts not loaded yet. Skipping chart creation.");
                    return; // Exit if prerequisites are not met
                }

                const handleResize = () => {
                    if (chartRef.current) {
                        chartRef.current.applyOptions({ width: chartContainerRef.current.clientWidth });
                    }
                };

                // Destroy existing chart instance before creating a new one to prevent memory leaks
                if (chartRef.current) {
                    chartRef.current.remove();
                    chartRef.current = null;
                    seriesRef.current = null;
                }

                // Create chart
                const chart = window.LightweightCharts.createChart(chartContainerRef.current, {
                    width: chartContainerRef.current.clientWidth,
                    height: 300,
                    layout: {
                        backgroundColor: document.documentElement.classList.contains('dark') ? '#1A1D20' : '#FFFFFF',
                        textColor: document.documentElement.classList.contains('dark') ? '#F0F4F8' : '#1A1D20',
                    },
                    grid: {
                        vertLines: {
                            color: document.documentElement.classList.contains('dark') ? '#2E353C' : '#E2E8F0',
                        },
                        horzLines: {
                            color: document.documentElement.classList.contains('dark') ? '#2E353C' : '#E2E8F0',
                        },
                    },
                    rightPriceScale: {
                        borderColor: document.documentElement.classList.contains('dark') ? '#3D4955' : '#E2E8F0',
                    },
                    timeScale: {
                        borderColor: document.documentElement.classList.contains('dark') ? '#3D4955' : '#E2E8F0',
                        timeVisible: true,
                        secondsVisible: false,
                    },
                });

                chartRef.current = chart;

                // Add area series
                const newSeries = chart.addAreaSeries({
                    topColor: 'rgba(252, 213, 53, 0.5)', // Binance yellow
                    bottomColor: 'rgba(252, 213, 53, 0.05)',
                    lineColor: '#FCD535',
                    lineWidth: 2,
                });
                seriesRef.current = newSeries;

                // Set data
                if (data && data.length > 0) {
                    newSeries.setData(data);
                }

                window.addEventListener('resize', handleResize);

                return () => {
                    window.removeEventListener('resize', handleResize);
                    if (chartRef.current) {
                        chartRef.current.remove(); // Dispose of the chart instance
                        chartRef.current = null;
                        seriesRef.current = null;
                    }
                };
            }, [data, coinSymbol, window.LightweightCharts]);


        const HomePage = ({ navigate }) => {
            const { userStatus } = useContext(UserContext);
            const displayAddress = userStatus.connectedWalletInfo?.address || userStatus.connectedWalletInfo?.username || 'Not Connected';
            const displayBalance = userStatus.connectedWalletInfo?.balance || '0.00 USD';
            const [marketData, setMarketData] = useState([]);
            const [newsData, setNewsData] = useState([]);
            const [chartData, setChartData] = useState([]);
            const [loadingMarket, setLoadingMarket] = useState(true);
            const [loadingNews, setLoadingNews] = useState(true);

            // Fetch Market Data from CoinGecko
            useEffect(() => {
                const fetchMarketData = async () => {
                    setLoadingMarket(true);
                    try {
                        // Using CoinGecko's public API for top 10 coins by market cap
                        const response = await fetch('https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&order=market_cap_desc&per_page=10&page=1&sparkline=false&price_change_percentage=24h');
                        const data = await response.json();
                        setMarketData(data.map(coin => ({
                            symbol: coin.symbol.toUpperCase(),
                            name: coin.name,
                            price: coin.current_price.toLocaleString('en-US', { style: 'currency', currency: 'USD' }),
                            change: coin.price_change_percentage_24h ? coin.price_change_percentage_24h.toFixed(2) : '0.00',
                            isPositive: coin.price_change_percentage_24h >= 0,
                            image: coin.image
                        })));

                        // Simulate chart data for BTC
                        const simulatedChartData = Array.from({ length: 30 }, (_, i) => {
                            const date = new Date();
                            date.setDate(date.getDate() - (29 - i));
                            const value = 60000 + Math.sin(i * 0.5) * 5000 + Math.random() * 2000;
                            return { time: date.toISOString().slice(0, 10), value: parseFloat(value.toFixed(2)) };
                        });
                        setChartData(simulatedChartData);

                    } catch (error) {
                        console.error("Error fetching market data:", error);
                        showModal("Failed to fetch market data. Please try again later.");
                    } finally {
                        setLoadingMarket(false);
                    }
                };

                // Simulate News Data (CoinGecko free API does not provide a direct news feed)
                const fetchNewsData = () => {
                    setLoadingNews(true);
                    setTimeout(() => {
                        setNewsData([
                            { title: "Bitcoin Price Reaches New All-Time High!", source: "CoinDesk", date: "2 hours ago" },
                            { title: "Ethereum Upgrade Successfully Deployed", source: "Decrypt", date: "5 hours ago" },
                            { title: "DeFi Sector Sees Major Inflows", source: "The Block", date: "1 day ago" },
                            { title: "New Regulations Proposed for Stablecoins", source: "Bloomberg Crypto", date: "2 days ago" },
                        ]);
                        setLoadingNews(false);
                    }, 1000);
                };

                fetchMarketData();
                fetchNewsData();

                // Refresh data periodically (e.g., every 5 minutes for market data)
                const marketDataInterval = setInterval(fetchMarketData, 5 * 60 * 1000);
                return () => clearInterval(marketDataInterval);
            }, []);


            const MarketCard = ({ symbol, name, price, change, isPositive, image }) => (
                <div className="bg-white dark:bg-dark-surface p-4 rounded-lg shadow dark:shadow-md border border-gray-100 dark:border-gray-700 flex flex-col items-center justify-center text-center">
                    {image && <img src={image} alt={`${name} icon`} className="w-8 h-8 mb-2" />}
                    <div className="text-xl font-bold text-text-dark dark:text-text-light">{symbol}</div>
                    <div className="text-sm text-text-muted-light dark:text-text-muted-dark mb-2">{name}</div>
                    <div className="text-lg font-semibold text-text-dark dark:text-text-light mb-1">{price}</div>
                    <div className={`text-sm ${isPositive ? 'text-green-500' : 'text-red-500'}`}>{change}%</div>
                </div>
            );

            const QuickActionBtn = ({ text, onClick }) => (
                <button
                    onClick={onClick}
                    className="flex flex-col items-center justify-center p-4 bg-white dark:bg-dark-surface rounded-lg shadow dark:shadow-md hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200"
                >
                    <span className="text-sm font-medium text-text-dark dark:text-text-light">{text}</span>
                </button>
            );

            return (
                <div className="min-h-screen bg-primary-light dark:bg-primary-dark pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        {/* Binance-style Hero/Banner Section */}
                        <section className="bg-gradient-to-r from-blue-600 to-purple-600 text-white p-8 rounded-xl shadow-lg mb-8 flex flex-col md:flex-row items-center justify-between text-center md:text-left">
                            <div className="mb-4 md:mb-0">
                                <h1 className="text-3xl sm:text-4xl font-bold mb-2">Trade Smarter, Live Better</h1>
                                <p className="text-lg opacity-90">Buy, sell, and manage your crypto assets with confidence on the world's leading exchange.</p>
                            </div>
                            <div className="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                                <button
                                    onClick={() => navigate('walletConnectPage')}
                                    className="px-6 py-3 bg-white text-blue-600 font-semibold rounded-lg hover:bg-gray-100 transition-colors duration-200 shadow-md"
                                >
                                    Start Trading
                                </button>
                                <button
                                    onClick={() => showModal('Simulating learning crypto...')}
                                    className="px-6 py-3 border border-white text-white font-semibold rounded-lg hover:bg-white hover:text-blue-600 transition-colors duration-200 shadow-md"
                                >
                                    Learn Crypto
                                </button>
                            </div>
                        </section>

                        {/* Connection Status & Balance (Moved to be more prominent for wallet app context) */}
                        <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg mb-8 flex flex-col sm:flex-row justify-between items-center text-text-dark dark:text-text-light">
                            <div>
                                <h2 className="text-2xl font-bold mb-2">Your Wallet Overview</h2>
                                {userStatus.isLoggedIn ? (
                                    userStatus.connectedWalletInfo ? (
                                        <p className="text-lg">
                                            Wallet: <span className="font-semibold text-accent-dark">
                                                {displayAddress.length > 20 ? `${displayAddress.substring(0, 10)}...${displayAddress.substring(displayAddress.length - 8)}}` : displayAddress}
                                            </span>
                                        </p>
                                    ) : (
                                        <p className="text-lg">Logged in, but no wallet connected.</p>
                                    )
                                ) : (
                                    <p className="text-lg">Please log in or connect your wallet to see details.</p>
                                )}
                            </div>
                            <div className="mt-4 sm:mt-0 text-right">
                                <h3 className="text-xl font-semibold">Total Balance (Est.)</h3>
                                <p className="text-3xl font-bold text-accent-dark">{displayBalance}</p>
                            </div>
                        </div>

                        {/* Quick Actions (Binance Style) */}
                        <div className="mb-8 bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg">
                            <h2 className="text-2xl font-bold text-text-dark dark:text-text-light mb-4">Quick Actions</h2>
                            <div className="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4">
                                <QuickActionBtn text={"Buy Crypto"} onClick={() => showModal('Simulating Buy Crypto flow...')} />
                                <QuickActionBtn text={"Deposit"} onClick={() => showModal('Simulating Deposit flow...')} />
                                <QuickActionBtn text={"Withdraw"} onClick={() => showModal('Simulating Withdraw flow...')} />
                                <QuickActionBtn text={"Trade"} onClick={() => showModal('Simulating Trade interface...')} />
                                <QuickActionBtn text={"Convert"} onClick={() => showModal('Simulating Convert interface...')} />
                                <QuickActionBtn text={"Earn"} onClick={() => showModal('Simulating Earn products...')} />
                            </div>
                        </div>

                        {/* Market Overview with Live Data */}
                        <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg mb-8">
                            <h2 className="text-2xl font-bold text-text-dark dark:text-text-light mb-4">Market Overview</h2>
                            {loadingMarket ? (
                                <div className="text-center py-8 text-text-muted-dark">Loading market data...</div>
                            ) : (
                                <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4">
                                    {marketData.map((data, index) => (
                                        <MarketCard key={index} {...data} />
                                    ))}
                                </div>
                            )}
                            <div className="text-right mt-4">
                                <button onClick={() => showModal('Simulating View More Markets...')} className="text-accent-dark hover:underline font-medium">View More Markets</button>
                            </div>
                        </div>

                        {/* Live Chart Performance */}
                        <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg mb-8">
                             {loadingMarket ? (
                                <div className="text-center py-8 text-text-muted-dark">Loading chart data...</div>
                            ) : (
                                <TradingViewChart data={chartData} coinSymbol="BTC" />
                            )}
                        </div>

                        {/* Market News (Simulated) */}
                        <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg">
                            <h2 className="text-2xl font-bold text-text-dark dark:text-text-light mb-4">Latest Crypto News</h2>
                            {loadingNews ? (
                                <div className="text-center py-8 text-text-muted-dark">Loading news...</div>
                            ) : (
                                <ul className="space-y-4">
                                    {newsData.map((news, index) => (
                                        <li key={index} className="border-b border-gray-100 dark:border-gray-700 pb-3 last:border-b-0">
                                            <a href="#" onClick={(e) => { e.preventDefault(); showModal(`Reading news: ${news.title}`); }} className="block text-text-dark dark:text-text-light hover:text-accent-dark font-medium text-lg">
                                                {news.title}
                                            </a>
                                            <p className="text-sm text-text-muted-light dark:text-text-muted-dark">{news.source} ‚Ä¢ {news.date}</p>
                                        </li>
                                    ))}
                                </ul>
                            )}
                            <div className="text-right mt-4">
                                <button onClick={() => showModal('Simulating View All News...')} className="text-accent-dark hover:underline font-medium">View All News</button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const WalletDashboard = ({ navigate }) => {
            const { userStatus } = useContext(UserContext);
            const totalBalance = userStatus.connectedWalletInfo?.balance || '0.00 USD';
            const connectedAddress = userStatus.connectedWalletInfo?.address;

            const [activeTab, setActiveTab] = useState('overview'); // 'overview', 'spot', 'futures', 'earn', 'nft'
            const [marketData, setMarketData] = useState([]); // For real-time asset prices
            const [loadingAssets, setLoadingAssets] = useState(true);

            // Simulated user assets for the dashboard
            // In a real app, this would be fetched from an authenticated Binance API
            const simulatedUserAssets = [
                { id: 'bitcoin', ticker: 'BTC', name: 'Bitcoin', total: '0.005', available: '0.005', inOrder: '0', icon: 'https://assets.coingecko.com/coins/images/1/large/bitcoin.png' },
                { id: 'ethereum', ticker: 'ETH', name: 'Ethereum', total: '0.12', available: '0.12', inOrder: '0', icon: 'https://assets.coingecko.com/coins/images/279/large/ethereum.png' },
                { id: 'binancecoin', ticker: 'BNB', name: 'BNB', total: '0.5', available: '0.5', inOrder: '0', icon: 'https://assets.coingecko.com/coins/images/825/large/binance-coin-logo.png' },
                { id: 'tether', ticker: 'USDT', name: 'TetherUS', total: '100.00', available: '100.00', inOrder: '0', icon: 'https://assets.coingecko.com/coins/images/325/large/Tether.png' },
                { id: 'solana', ticker: 'SOL', name: 'Solana', total: '0.8', available: '0.8', inOrder: '0', icon: 'https://assets.coingecko.com/coins/images/4128/large/solana.png' },
            ];

            // Fetch live prices for user's assets from CoinGecko
            useEffect(() => {
                const fetchAssetPrices = async () => {
                    setLoadingAssets(true);
                    try {
                        const coinIds = simulatedUserAssets.map(asset => asset.id).join(',');
                        const response = await fetch(`https://api.coingecko.com/api/v3/simple/price?ids=${coinIds}&vs_currencies=usd&include_24hr_change=true`);
                        const data = await response.json();

                        const updatedAssets = simulatedUserAssets.map(asset => {
                            const priceData = data[asset.id] || {};
                            const currentPrice = priceData.usd || 0;
                            const priceChange = priceData.usd_24hr_change || 0;
                            const usdValue = (parseFloat(asset.total) * currentPrice).toFixed(2);
                            return {
                                ...asset,
                                currentPrice: currentPrice,
                                usdValue: usdValue,
                                priceChange24h: priceChange.toFixed(2),
                                isPositive: priceChange >= 0
                            };
                        });
                        setMarketData(updatedAssets);
                    } catch (error) {
                        console.error("Error fetching asset prices:", error);
                        showModal("Failed to fetch live asset prices. Displaying simulated values.");
                        // Fallback to initial simulated assets without live price updates
                        setMarketData(simulatedUserAssets.map(asset => ({
                            ...asset,
                            currentPrice: 'N/A',
                            usdValue: (parseFloat(asset.total) * (Math.random() * 1000 + 100)).toFixed(2), // Random simulated USD value
                            priceChange24h: (Math.random() * 4 - 2).toFixed(2), // Random change +/- 2%
                            isPositive: (Math.random() * 4 - 2) >= 0
                        })));
                    } finally {
                        setLoadingAssets(false);
                    }
                };

                fetchAssetPrices();
                const interval = setInterval(fetchAssetPrices, 60 * 1000); // Refresh every minute
                return () => clearInterval(interval);
            }, []);


            const TransactionHistoryItem = ({ type, asset, amount, date, status }) => (
                <li className="flex justify-between items-center py-3 border-b border-gray-100 dark:border-gray-700 last:border-b-0">
                    <div>
                        <div className="font-semibold text-text-dark dark:text-text-light">{type} {asset}</div>
                        <div className="text-sm text-text-muted-light dark:text-text-muted-dark">{date}</div>
                    </div>
                    <div className="text-right">
                        <div className={`font-medium ${type === 'Deposit' ? 'text-green-500' : 'text-red-500'}`}>
                            {type === 'Deposit' ? '+' : '-'} {amount} {asset}
                        </div>
                        <div className="text-sm text-text-muted-light dark:text-text-muted-dark">{status}</div>
                    </div>
                </li>
            );

            const handleDeposit = () => showModal('Simulating Deposit function... (e.g., show QR code)');
            const handleWithdraw = () => showModal('Simulating Withdraw function... (e.g., show form)');
            const handleTrade = () => showModal('Simulating Trade function... (e.g., redirect to trading page)');

            return (
                <div className="min-h-screen bg-primary-light dark:bg-primary-dark pt-16 transition-colors duration-300">
                    <div className="container mx-auto px-4 py-8">
                        {/* Wallet Overview Header */}
                        <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg mb-8">
                            <h1 className="text-3xl font-bold text-text-dark dark:text-text-light mb-2">Wallet Overview</h1>
                            <p className="text-text-muted-light dark:text-text-muted-dark mb-4">
                                {userStatus.isLoggedIn && connectedAddress ? `Connected Wallet: ${connectedAddress.length > 20 ? `${connectedAddress.substring(0, 10)}...${connectedAddress.substring(connectedAddress.length - 8)}` : connectedAddress}` : 'No wallet connected'}
                            </p>
                            <div className="flex flex-col sm:flex-row items-end justify-between mb-4">
                                <div>
                                    <p className="text-text-muted-light dark:text-text-muted-dark text-lg">Estimated Balance</p>
                                    <p className="text-4xl font-bold text-text-dark dark:text-text-light">{totalBalance}</p>
                                </div>
                                <div className="flex space-x-3 mt-4 sm:mt-0">
                                    <button onClick={handleDeposit} className="px-5 py-2 bg-green-500 text-white font-semibold rounded-lg hover:bg-green-600 transition-colors duration-200">Deposit</button>
                                    <button onClick={handleWithdraw} className="px-5 py-2 bg-red-500 text-white font-semibold rounded-lg hover:bg-red-600 transition-colors duration-200">Withdraw</button>
                                    <button onClick={handleTrade} className="px-5 py-2 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors duration-200">Trade</button>
                                </div>
                            </div>
                        </div>

                        {/* Navigation Tabs */}
                        <div className="flex justify-center border-b border-gray-200 dark:border-gray-700 mb-8 overflow-x-auto">
                            {['overview', 'spot', 'futures', 'earn', 'nft', 'transactionHistory'].map(tab => (
                                <button
                                    key={tab}
                                    onClick={() => setActiveTab(tab)}
                                    className={`px-4 py-3 text-base font-medium whitespace-nowrap ${activeTab === tab ? 'text-accent-dark border-b-2 border-accent-dark' : 'text-text-muted-light dark:text-text-muted-dark hover:text-text-dark dark:hover:text-text-light'}`}
                                >
                                    {tab === 'transactionHistory' ? 'History' : tab.charAt(0).toUpperCase() + tab.slice(1)}
                                </button>
                            ))}
                        </div>

                        {/* Content based on Active Tab */}
                        {activeTab === 'overview' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg">
                                    <h2 className="text-2xl font-bold text-text-dark dark:text-text-light mb-4">Spot Wallet Balance</h2>
                                    {loadingAssets ? (
                                        <div className="text-center py-8 text-text-muted-dark">Loading assets...</div>
                                    ) : (
                                        <ul className="space-y-3">
                                            {marketData.map(asset => (
                                                <li key={asset.ticker} className="flex justify-between items-center py-2 border-b border-gray-100 dark:border-gray-700 last:border-b-0">
                                                    <div className="flex items-center space-x-2">
                                                        {asset.icon && <img src={asset.icon} alt={`${asset.name} icon`} className="w-6 h-6" />}
                                                        <span className="font-medium text-text-dark dark:text-text-light">{asset.ticker}</span>
                                                    </div>
                                                    <div className="text-right">
                                                        <span className="text-text-dark dark:text-text-light">{asset.total} {asset.ticker}</span>
                                                        <span className="text-text-muted-light dark:text-text-muted-dark block text-sm">${asset.usdValue}</span>
                                                        <span className={`text-sm ${asset.isPositive ? 'text-green-500' : 'text-red-500'}`}>{asset.priceChange24h}%</span>
                                                    </div>
                                                </li>
                                            ))}
                                        </ul>
                                    )}
                                    <div className="text-right mt-4">
                                        <button onClick={() => setActiveTab('spot')} className="text-accent-dark hover:underline font-medium">View Spot Wallet</button>
                                    </div>
                                </div>

                                <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg">
                                    <h2 className="text-2xl font-bold text-text-dark dark:text-text-light mb-4">Recent Transactions</h2>
                                    <ul className="space-y-3">
                                        <TransactionHistoryItem type="Deposit" asset="USDT" amount="100.00" date="2025-07-30" status="Completed" />
                                        <TransactionHistoryItem type="Trade" asset="BTC" amount="0.0001" date="2025-07-29" status="Filled" />
                                        <TransactionHistoryItem type="Withdraw" asset="ETH" amount="0.01" date="2025-07-28" status="Completed" />
                                        <TransactionHistoryItem type="Deposit" asset="BNB" amount="0.1" date="2025-07-27" status="Completed" />
                                    </ul>
                                    <div className="text-right mt-4">
                                        <button onClick={() => setActiveTab('transactionHistory')} className="text-accent-dark hover:underline font-medium">View All History</button>
                                    </div>
                                </div>
                            </div>
                        )}

                        {activeTab === 'spot' && (
                            <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg">
                                <h2 className="text-2xl font-bold text-text-dark dark:text-text-light mb-4">Spot Wallet</h2>
                                <div className="overflow-x-auto">
                                    <table className="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
                                        <thead className="bg-gray-50 dark:bg-dark-surface">
                                            <tr>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-text-muted-dark uppercase tracking-wider">Asset</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-text-muted-dark uppercase tracking-wider">Total</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-text-muted-dark uppercase tracking-wider">Available</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-text-muted-dark uppercase tracking-wider">In Order</th>
                                                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-text-muted-dark uppercase tracking-wider">USD Value</th>
                                                <th scope="col" className="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-text-muted-dark uppercase tracking-wider">Actions</th>
                                            </tr>
                                        </thead>
                                        <tbody className="bg-white dark:bg-secondary-dark divide-y divide-gray-200 dark:divide-gray-700">
                                            {loadingAssets ? (
                                                <tr><td colSpan="6" className="text-center py-4 text-text-muted-dark">Loading assets...</td></tr>
                                            ) : (
                                                marketData.map(asset => (
                                                    <tr key={asset.ticker}>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-text-dark dark:text-text-light">
                                                            <div className="flex items-center space-x-2">
                                                                {asset.icon && <img src={asset.icon} alt={`${asset.name} icon`} className="w-6 h-6" />}
                                                                <span>{asset.ticker}</span>
                                                            </div>
                                                        </td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-text-dark dark:text-text-light">{asset.total}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-text-dark dark:text-text-light">{asset.available}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-text-dark dark:text-text-light">{asset.inOrder}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-sm text-text-dark dark:text-text-light">${asset.usdValue}</td>
                                                        <td className="px-6 py-4 whitespace-nowrap text-right text-sm font-medium space-x-2">
                                                            <button onClick={handleDeposit} className="text-green-600 hover:text-green-900 dark:text-green-400 dark:hover:text-green-300">Deposit</button>
                                                            <button onClick={handleWithdraw} className="text-red-600 hover:text-red-900 dark:text-red-400 dark:hover:text-red-300">Withdraw</button>
                                                            <button onClick={handleTrade} className="text-blue-600 hover:text-blue-900 dark:text-blue-400 dark:hover:text-blue-300">Trade</button>
                                                        </td>
                                                    </tr>
                                                ))
                                            )}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {activeTab === 'futures' && (
                            <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg text-center">
                                <h2 className="text-2xl font-bold text-text-dark dark:text-text-light mb-4">Futures Wallet</h2>
                                <p className="text-text-muted-light dark:text-text-muted-dark mb-4">
                                    Engage in crypto futures trading. This is a simulated section. Full functionality requires a separate API integration.
                                </p>
                                <button onClick={() => showModal('Simulating Futures Trading Page...')} className="px-6 py-3 bg-blue-500 text-white font-semibold rounded-lg hover:bg-blue-600 transition-colors duration-200">Go to Futures</button>
                            </div>
                        )}

                        {activeTab === 'earn' && (
                            <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg text-center">
                                <h2 className="text-2xl font-bold text-text-dark dark:text-text-light mb-4">Earn</h2>
                                <p className="text-text-muted-light dark:text-text-muted-dark mb-4">
                                    Put your crypto to work and earn passive income. This is a simulated section.
                                </p>
                                <button onClick={() => showModal('Simulating Earn Products Page...')} className="px-6 py-3 bg-purple-500 text-white font-semibold rounded-lg hover:bg-purple-600 transition-colors duration-200">Explore Earn</button>
                            </div>
                        )}

                        {activeTab === 'nft' && (
                            <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg text-center">
                                <h2 className="text-2xl font-bold text-text-dark dark:text-text-light mb-4">NFT Wallet</h2>
                                <p className="text-text-muted-light dark:text-text-muted-dark mb-4">
                                    Manage your unique digital collectibles. This is a simulated section.
                                </p>
                                <button onClick={() => showModal('Simulating NFT Marketplace...')} className="px-6 py-3 bg-pink-500 text-white font-semibold rounded-lg hover:bg-pink-600 transition-colors duration-200">View NFTs</button>
                            </div>
                        )}

                        {activeTab === 'transactionHistory' && (
                            <div className="bg-white dark:bg-secondary-dark p-6 rounded-xl shadow-lg">
                                <h2 className="text-2xl font-bold text-text-dark dark:text-text-light mb-4">Full Transaction History</h2>
                                <p className="text-text-muted-light dark:text-text-muted-dark mb-4">
                                    Detailed history of your deposits, withdrawals, and trades. (Simulated Data)
                                </p>
                                <ul className="space-y-3">
                                    <TransactionHistoryItem type="Deposit" asset="USDT" amount="100.00" date="2025-07-30 14:30" status="Completed" />
                                    <TransactionHistoryItem type="Trade" asset="BTC" amount="0.0001" date="2025-07-29 10:15" status="Filled" />
                                    <TransactionHistoryItem type="Withdraw" asset="ETH" amount="0.01" date="2025-07-28 18:00" status="Completed" />
                                    <TransactionHistoryItem type="Deposit" asset="BNB" amount="0.1" date="2025-07-27 09:00" status="Completed" />
                                    <TransactionHistoryItem type="Trade" asset="SOL" amount="0.5" date="2025-07-26 11:45" status="Filled" />
                                    <TransactionHistoryItem type="Deposit" asset="ETH" amount="0.05" date="2025-07-25 16:20" status="Completed" />
                                    <TransactionHistoryItem type="Withdraw" asset="USDT" amount="20.00" date="2025-07-24 13:00" status="Processing" />
                                    <TransactionHistoryItem type="Trade" asset="BNB" amount="0.02" date="2025-07-23 09:30" status="Canceled" />
                                </ul>
                                <div className="text-center mt-6 text-text-muted-dark">
                                    <p>End of simulated history.</p>
                                </div>
                            </div>
                        )}
                    </div>
                </div>
            );
        };

        const SettingsPage = ({ navigate, setUserStatus }) => {
            const handleLogout = () => {
                showModal('Logging out...');
                setTimeout(() => {
                    setUserStatus({ isLoggedIn: false, connectedWalletInfo: null });
                    navigate('landingPage');
                    hideModal();
                }, 2000); // Simulate logout delay
            };

            return (
                <div className="min-h-screen flex flex-col items-center justify-center bg-primary-light dark:bg-primary-dark pt-16 transition-colors duration-300 p-4">
                    <div className="bg-white dark:bg-secondary-dark p-8 rounded-xl shadow-lg w-11/12 max-w-md border border-gray-200 dark:border-gray-700">
                        <h2 className="text-3xl font-bold text-text-dark dark:text-text-light mb-6 text-center">Settings</h2>
                        <div className="flex flex-col space-y-4">
                            <button
                                onClick={() => showModal('Simulating Profile Settings...')}
                                className="w-full px-6 py-3 border border-gray-300 dark:border-gray-700 text-text-dark dark:text-text-light font-semibold rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200"
                            >
                                Profile Settings
                            </button>
                            <button
                                onClick={() => showModal('Simulating Security Settings...')}
                                className="w-full px-6 py-3 border border-gray-300 dark:border-gray-700 text-text-dark dark:text-text-light font-semibold rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors duration-200"
                            >
                                Security Settings
                            </button>
                            <button
                                onClick={handleLogout}
                                className="w-full px-6 py-3 bg-red-500 text-white font-semibold rounded-lg shadow-md hover:bg-red-600 transition-colors duration-200"
                            >
                                Log Out
                            </button>
                        </div>
                    </div>
                </div>
            );
        };


        // --- Main App Component ---
        const App = () => {
            const [isDarkMode, setIsDarkMode] = useState(() => {
                if (localStorage.getItem('theme')) {
                    return localStorage.getItem('theme') === 'dark';
                }
                return window.matchMedia('(prefers-color-scheme: dark)').matches;
            });

            const [history, setHistory] = useState(['landingPage']);
            const currentPage = history[history.length - 1];

            const [userStatus, setUserStatus] = useState(() => {
                // Initialize user status from session storage for persistence across reloads
                const savedUserStatus = sessionStorage.getItem('userStatus');
                return savedUserStatus ? JSON.parse(savedUserStatus) : { isLoggedIn: false, connectedWalletInfo: null };
            });

            useEffect(() => {
                // Save user status to session storage whenever it changes
                sessionStorage.setItem('userStatus', JSON.stringify(userStatus));
            }, [userStatus]);


            const toggleDarkMode = useCallback(() => {
                setIsDarkMode(prevMode => {
                    const newMode = !prevMode;
                    localStorage.setItem('theme', newMode ? 'dark' : 'light');
                    return newMode;
                });
            }, []);

            useEffect(() => {
                if (isDarkMode) {
                    document.documentElement.classList.add('dark');
                    document.documentElement.classList.remove('light');
                } else {
                    document.documentElement.classList.remove('dark');
                    document.documentElement.classList.add('light');
                }
            }, [isDarkMode]);

            const navigate = (pageName) => {
                setHistory(prevHistory => {
                    // If navigating back to a page already in history, trim history
                    const existingIndex = prevHistory.indexOf(pageName);
                    if (existingIndex !== -1) {
                        return prevHistory.slice(0, existingIndex + 1);
                    }
                    return [...prevHistory, pageName];
                });
            };

            const goBack = () => {
                setHistory(prevHistory => {
                    if (prevHistory.length > 1) {
                        return prevHistory.slice(0, prevHistory.length - 1);
                    }
                    return prevHistory; // Stay on current page if no history
                });
            };

            const showBackButton = history.length > 1 && currentPage !== 'landingPage'; // Don't show back button on landing

            let PageComponent;
            switch (currentPage) {
                case 'getStartedPage':
                    PageComponent = <GetStartedPage navigate={navigate} />;
                    break;
                case 'loginPage':
                    PageComponent = <LoginPage navigate={navigate} setUserStatus={setUserStatus} />;
                    break;
                case 'walletConnectPage':
                    PageComponent = <WalletConnectPage navigate={navigate} setUserStatus={setUserStatus} />;
                    break;
                case 'homePage':
                    PageComponent = <HomePage navigate={navigate} />;
                    break;
                case 'walletDashboard':
                    PageComponent = <WalletDashboard navigate={navigate} />;
                    break;
                case 'settingsPage':
                    PageComponent = <SettingsPage navigate={navigate} setUserStatus={setUserStatus} />;
                    break;
                case 'landingPage':
                default:
                    PageComponent = <LandingPage navigate={navigate} />;
                    break;
            }

            return (
                <UserContext.Provider value={{ userStatus, setUserStatus }}>
                    <div className="min-h-screen bg-primary-light dark:bg-primary-dark text-text-dark dark:text-text-light transition-colors duration-300">
                        <Header toggleDarkMode={toggleDarkMode} isDarkMode={isDarkMode} navigate={navigate} goBack={goBack} showBackButton={showBackButton} />
                        <main className="min-h-[calc(100vh-160px)]"> {/* Adjust min-height to account for header/footer */}
                            {PageComponent}
                        </main>
                        <Footer />
                    </div>
                </UserContext.Provider>
            );
        };

        // Render the React app
        window.onload = function () {
            ReactDOM.createRoot(document.getElementById('root')).render(<App />);
        };
    </script>
</body>
</html>


          
    
    
    
                

          
    
    
    
          
